# SuiStride - 你的 Web3 健身伙伴

SuiStride 是一款构建在 Sui 区块链上的创新性 "Run-to-Earn" (边跑边赚) dApp。它将现实世界的跑步健身活动与 Web3 的激励机制无缝结合，旨在让运动更有趣、更有价值，并极大地降低了普通用户进入 Web3 世界的门槛。

## 核心优势

与市场上的同类产品相比，SuiStride 拥有两大核心优势：

1.  **极致的用户体验**: 我们利用 Sui 的 ZKLogin 功能，实现了 **Google 账户一键登录**。用户无需理解复杂的助记词和钱包概念，即可拥有一个链上账户，体验与 Web2 应用无异的丝滑流程。
2.  **跨平台快速迭代**: 通过独特的混合架构，我们的 Web 端和移动端（iOS/Android）共享同一套核心代码库。这意味着新功能可以同步上线，保证了所有平台用户体验的一致性。

## 功能亮点

### 移动端支持 & 社交登录

-   **随时随地，开跑即赚**: 完整的移动端支持，让你摆脱电脑束缚，仅需一部手机即可参与所有核心功能。
-   **社交裂变，轻松获客**: 社交登录不仅简化了注册流程，更打通了 Web2 的流量入口。用户可以轻松地邀请朋友参与，极大地增强了应用的病毒式传播潜力。

### Stake-to-Run & Run-to-Earn 模式

我们创新的经济模型旨在激励真实、有效的运动：

-   **承诺与激励**: 用户通过质押 (Stake) Token 加入一个跑步奖金池 (Pool)，这不仅是一种参与承诺，也是奖金池的来源。
-   **降低作恶动机**: 与简单的空投模式不同，先质押再跑步的模式筛选出了真正愿意参与运动的用户，并通过博弈论降低了潜在的作弊动机。
-   **按劳分配**: 跑步结束后，奖金池会根据所有参与者的步数和排名进行分配，前50%的优胜者将分享奖金。跑得越多，排名越高，收益越大。

## 技术详解：如何保证公平与效率

我们深知，对于 Run-to-Earn 应用而言，防作弊是决定项目成败的生命线。为此，我们设计了一套兼具安全性、高效率和低成本的链上链下结合验证方案。

### 防作弊与链上验证机制

我们的防作弊系统分为客户端数据处理和链上验证两个层面，通过密码学确保每一次跑步数据的真实可信。

1.  **客户端数据预处理**:
    -   **数据平滑 (Kalman Filter)**: 移动设备的原生 GPS 信号存在噪声和漂移。我们采用类似于**卡尔曼滤波器**的算法，对原始坐标数据进行平滑处理，消除异常点，得到一条更真实、更平滑的运动轨迹。
    -   **隐私保护与数据分段**: 为了保护用户隐私，应用不会上传用户的完整 GPS 轨迹。相反，我们将平滑后的数据转换为以起点为原点的相对坐标，并将其切分为以1分钟为单位的 **`RunSegment` (运动分片)**。每个分片包含该时段的起止坐标、平均/最大速度、步数、加速度方差等关键运动指标。

2.  **默克尔树承诺 (Merkle Tree Commitment)**:
    -   所有 `RunSegment` 在本地被序列化为二进制数据，并逐一进行 SHA-256 哈希计算，形成默克尔树的叶子节点。
    -   通过逐层哈希，最终生成一个唯一的 **默克尔根 (Merkle Root)**。这个根就像是本次跑步所有详细数据的“数字指纹”。

3.  **高效的链上验证**:
    -   用户结束跑步时，**仅将这个32字节的默克尔根和总步数提交上链**，而不是提交庞大的 GPS 数据。
    -   这种设计的优势是巨大的：极大地降低了用户的 Gas 成本，并避免了 Sui 网络的拥堵。智能合约仅需存储这个“数字指纹”，就完成了对整个运动过程的密码学承诺。
    -   在未来，如果出现争议，我们或社区可以运行一个链下验证程序。用户只需提供某个 `RunSegment` 的原始数据及其对应的默克尔证明，即可在不信任的环境下验证该数据是否属于最初提交的默克尔根，从而实现可信仲裁。

![防作弊流程图](https://i.imgur.com/your-graph-image-link-here.png)  
*图1: 从GPS数据到链上默克尔根的防作弊流程*

### 智能合约架构 (Sui Move)

合约位于 `sui_contract/sui_stride/sources/`，主要包含以下模块和对象：

-   **`core.move`**: 实现了所有核心逻辑。
    -   **`StakingPool<T>`**: 共享对象，是活动的核心。它定义了奖金池的名称、时长、参与者列表和资金库。
    -   **`UserData`**: 归属于用户的个人数据对象，存储总步数、质押信息等。
    -   **`Session`**: 归属于用户的临时对象，在用户开始跑步时创建，结束时销毁。它包含一个与纪元相关的 `nonce`，有效防止了对同一次跑步数据的“重放攻击”。
-   **关键函数**:
    -   `create_pool`: 创建一个新的跑步奖金池。
    -   `stake`: 用户质押 Token 加入一个奖金池。
    -   `start_run`: 开始跑步，创建 `Session` 对象。
    -   `submit_run_with_proof`: 提交跑步结果，包含总步数和默克尔根，并销毁 `Session` 对象。
    -   `distribute_rewards`: 活动结束后，根据排名算法（目前为简单的冒泡排序）将奖金分发给优胜者。

### 前端架构

我们采用现代化的技术栈，确保开发效率和用户体验。

-   **Web 应用**:
    -   **框架**: Next.js 14 (App Router)
    -   **语言**: TypeScript
    -   **UI**: React, Tailwind CSS, shadcn/ui
    -   **状态管理**: React Context (`AuthProvider`) 统一管理钱包和 ZKLogin 状态。
    -   **地图**: Leaflet.js

-   **移动应用**:
    -   **框架**: React Native (Expo)
    -   **核心架构**: **WebView 混合模型**。应用内嵌一个 WebView 来直接渲染我们的 Next.js Web应用，实现了最大程度的代码复用。
    -   **原生桥接**: 通过 `postMessage` API，Webview 与 React Native 原生层进行双向通信。这使得Web应用可以调用原生功能，例如：
        -   **`useLocationTracking`**: 调用原生GPS模块，获取比浏览器更精确、更省电的地理位置信息。
        -   **`WebBrowser.openAuthSessionAsync`**: 调用原生浏览器窗口处理 ZKLogin 的 OAuth 流程，提供了比Webview内跳转更好的安全性和用户体验。

![前端架构图](https://i.imgur.com/your-architecture-image-link-here.png)  
*图2: Web与移动端混合架构示意图*

## 安装与运行

1.  **克隆仓库**
    ```bash
    git clone https://github.com/your-repo/suistride.git
    cd suistride
    ```

2.  **安装依赖**
    ```bash
    bun install
    ```

3.  **配置环境变量**
    复制 `.env.example` 为 `.env`，并填入你的 Sui 网络 RPC 地址、合约包 ID 等信息。

4.  **运行开发服务器**
    ```bash
    bun run dev
    ```

## 贡献指南

我们欢迎社区的任何贡献！请参考 `CONTRIBUTING.md` 获取详细信息。

## 许可证

本项目采用 [MIT](LICENSE) 许可证。